<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>OuterClub</title>

    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static',filename='css/misc.css') }}" />
    <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static',filename='css/footer.css') }}" />
<style type="text/css">
input,body {
    font-family: Helvetica, Arial, Sans-serif;
}
body {
    font-size: 12px;
    background-color: #333;
    margin: 0;
} 
#blackBg {
    background-color: #000
}
#blackBg .footer {
    color: #ccc;
}
#center {
	clear: both;
    margin: 0 auto 0 auto;
    height: 980px;
    background: url('/static/images/signup/bg.png') no-repeat top center;
    text-align: center;
    position: relative;
}
#center .error {
    color: #c33;
    display: none;
    margin-top: 10px;
    position:relative;
    margin-bottom: -28px;
    font-size: 16px;
}
.footer .error {
    display: inline;
    color: #c33;
    margin-left: 5px;
}
.footer input {
    font-size: 14px;
    padding: 1px;
}
.footer input[type='text'],.footer input[type='password'] {
    border: 1px solid #444;
    background-color: #111;
    color: #efefef;
    padding: 4px;
}

.slideshow {
	position:relative;
	top:140px;
	height: 469px;
	background: url(/static/images/signup/0.png) no-repeat top center;
}

/**
 * Input fields
 */
.wrap {
    width: 219px;
    height: 42px;
    margin: 25px 3px auto;
    background: url('/static/images/signup/bubble.png') no-repeat;
    display: inline-block;
    color: #3798b4;
    position: relative;
}
.wrap span {
    position: absolute;
    top: 13px;
    left: 22px;
    z-index: 1;
    font-size: 16px;
}
.wrap span.light {
    color: #67b8d4;
}
.wrap input {
    background: url('/static/images/new/transparent.png') repeat;
    border: 0;
    font-size: 16px;
    color: white;
    margin: 12px 0 0 0px;
    z-index: 99;
}

/**
 * Buttons.
 */
#center button[type='submit'] {
    height: 128px;
    width: 306px;
    background: url('/static/images/signup/submit.png') no-repeat;
    border: 0;
    margin-top: 5px
}

#center button[type='submit']:hover {
    background: url('/static/images/signup/submit_hover.png') no-repeat;
}
.dots {
    position:relative;
	margin-top: 70px;
	z-index: 99;
}
button {
	cursor: pointer;
}
button.dot:hover,button.dotActive {
	background: url('/static/images/signup/dot_hover.png') no-repeat;
}
button.dot,button.dotActive {
	height: 27px;
	width: 27px;
	border: 0;
}
button.dot {
	background: url('/static/images/signup/dot.png') no-repeat;
	}
.clear {
    clear: both;
}
</style>
{% if not config['DEBUG'] %}
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29349455-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
{% endif %}
</head>
<body>
<div id="blackBg">
    <div class="footer" style="border:0;border-bottom: 1px solid #333">
     <div class="footer_menu">
        <div class="footer_menu_left">
            <form action="/login" method="post">
            Username <input type="text" name="l_username" size="16" /> &nbsp;Password <input type="password" name="l_password" size="16" />
            <button type="submit" name="login" class="default">Log In</button><div class="error">
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            {{ messages[0] }}
            {% endif %}
            {% endwith %}</div>
            </form>
        </div>
     </div>
    </div>
    <div id="center">
    	<div class="slideshow">
    	</div>
    	<div class="dots">
    		<button class="dotActive" />
    		<button class="dot" />
    		<button class="dot" />
    	</div>
        <div class="wrap">
            <input type="text" name='email' />
            <span>EMAIL ADDRESS</span>
        </div>
        <div class="wrap">
            <input type="text" name='username' />
            <span>USERNAME</span>
        </div>
        <div class="wrap">
            <input type="password" name='password'/>
            <span>PASSWORD</span>
        </div>
        <div class="wrap">
            <input type="password" name='confirm'/>
            <span>CONFIRM PASSWORD</span>
        </div>
        <div class="error">
        </div>
        <div class="clear"></div>
        <button type="submit" />
    </div>
    <div class="footer">
        <div class="footer_menu">
            <div class="footer_menu_left">
            </div>
            <div class="footer_menu_right">
                &copy; 2012 OuterClub
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="/static/jquery-1.7.1.min.js"></script>
<script type="text/javascript">
function showError(msg) {
    $("#center .error").html(msg);
    if ($("#center .error").css('display') == 'none')
    {
        $("#center .error").fadeIn();
    }
}
var wait = 7000;
function slideshow() {
    var active = $(".dots .dotActive").index();
    var next = active < 2 ? active + 1 : 0;
    $($(".dots").children().get(next)).click();
    setTimeout('slideshow()',wait);
}
$(document).ready(function() {
    if ($.browser.msie) {
        $(".footer:first,.slideshow,.dots,.wrap,button").hide();
        $("#center").append('<div style="font-size:200%;padding-top:400px;color:white">Sorry, OuterClub does not support Internet Explorer at this time.</div>');
    } else {
        $("span").mousedown(function() {
            $(this).prev('input').focus();
            return false;
        });
        $("input[name='username'],input[name='email'],input[name='password'],input[name='confirm']").focusin(function() {
            $(this).next('span').addClass('light');
        });
        $("input[name='username'],input[name='password'],input[name='email'],input[name='confirm']").focusout(function() {
            if ($(this).val() == '')
                $(this).next('span').show();
             $(this).next('span').removeClass('light');
        });
        $("input[name='username'],input[name='email'],input[name='password'],input[name='confirm']").keypress(function() {
            $(this).next('span').hide();
        });
        
        var preload = new Image();
        preload.src = '/static/images/signup/0.png';
        preload.src = '/static/images/signup/1.png';
        preload.src = '/static/images/signup/2.png';
        $('.dots button').click(function() {
            $('.dots button').each(function() {
                if ($(this).hasClass('dotActive')) {
                    $(this).removeClass('dotActive');
                    $(this).addClass('dot');
                }
            });
            $(this).removeClass('dot');
            $(this).addClass('dotActive');
            var no = $(this).index();
            $('.slideshow').fadeOut(function() {
                $(this).css('background-image','url(/static/images/signup/'+no+'.png)');
                $(this).fadeIn();
            });

        });
        setTimeout('slideshow()',wait);
        $("button[type='submit']").click(function() {
            $.ajax({
                type:'POST',
                url:'/signup',
                data: { username: $("input[name='username']").val(), email: $("input[name='email']").val(),
                    password: $("input[name='password']").val(),confirm:$("input[name='confirm']").val(),
                    k: '{{ k }}' },
                success:function(data) {
                    if ('error' in data) {
                        showError(data['error']);
                    }
                    if ('user_id' in data && 'key' in data) {
                        document.cookie = 'user_id='+data['user_id']+';';
                        document.cookie = 'key='+data['key']+';';
                        window.location = '/';
                    }
                },
                dataType: 'json'
            });
        });
        preload.src = '/static/images/background.png';
    }
});
</script>
</body>
</html>
